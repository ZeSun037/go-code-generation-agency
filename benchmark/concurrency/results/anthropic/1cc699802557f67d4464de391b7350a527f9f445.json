{
    "task": "1cc699802557f67d4464de391b7350a527f9f445.txt",
    "provider": "anthropic",
    "model": "claude-haiku-4-5",
    "rounds": [
        {
            "code": "package main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype NodeManager struct {\n\tmu                  sync.Mutex\n\tclosed              bool\n\toutgoingConnections int\n\twg                  sync.WaitGroup\n\tshutdownChan        chan struct{}\n}\n\nfunc NewNodeManager() *NodeManager {\n\treturn &NodeManager{\n\t\tclosed:              false,\n\t\toutgoingConnections: 5,\n\t\tshutdownChan:        make(chan struct{}),\n\t}\n}\n\nfunc (nm *NodeManager) Start() {\n\tnm.wg.Add(2)\n\tgo nm.bootstrap()\n\tgo nm.manage()\n}\n\nfunc (nm *NodeManager) bootstrap() {\n\tdefer nm.wg.Done()\n\tticker := time.NewTicker(5 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor {\n\t\tselect {\n\t\tcase <-ticker.C:\n\t\t\tnm.mu.Lock()\n\t\t\tif nm.closed {\n\t\t\t\tnm.mu.Unlock()\n\t\t\t\tfmt.Println(\"[Bootstrap] Manager is closed, exiting bootstrap goroutine\")\n\t\t\t\treturn\n\t\t\t}\n\t\t\tnm.mu.Unlock()\n\t\t\tfmt.Println(\"[Bootstrap] Discovering and connecting to seed nodes\")\n\n\t\tcase <-nm.shutdownChan:\n\t\t\tfmt.Println(\"[Bootstrap] Received shutdown signal, exiting bootstrap goroutine\")\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc (nm *NodeManager) manage() {\n\tdefer nm.wg.Done()\n\tticker := time.NewTicker(3 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor {\n\t\tselect {\n\t\tcase <-ticker.C:\n\t\t\tnm.mu.Lock()\n\t\t\tclosed := nm.closed\n\t\t\tconnections := nm.outgoingConnections\n\t\t\tnm.mu.Unlock()\n\n\t\t\tfmt.Printf(\"[Manage] Managing connections: %d active connections\\n\", connections)\n\n\t\t\tif closed && connections == 0 {\n\t\t\t\tfmt.Println(\"[Manage] Manager is closed and no connections remain, exiting manage goroutine\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif connections > 0 {\n\t\t\t\tnm.mu.Lock()\n\t\t\t\tnm.outgoingConnections--\n\t\t\t\tnm.mu.Unlock()\n\t\t\t}\n\n\t\tcase <-nm.shutdownChan:\n\t\t\tfmt.Println(\"[Manage] Received shutdown signal\")\n\t\t\tnm.mu.Lock()\n\t\t\tif nm.outgoingConnections == 0 {\n\t\t\t\tnm.mu.Unlock()\n\t\t\t\tfmt.Println(\"[Manage] No connections remain, exiting manage goroutine\")\n\t\t\t\treturn\n\t\t\t}\n\t\t\tnm.mu.Unlock()\n\t\t}\n\t}\n}\n\nfunc (nm *NodeManager) Shutdown() {\n\tfmt.Println(\"[Shutdown] Starting graceful shutdown\")\n\n\tnm.mu.Lock()\n\tnm.closed = true\n\tnm.mu.Unlock()\n\n\tclose(nm.shutdownChan)\n\n\tnm.wg.Wait()\n\tfmt.Println(\"[Shutdown] All goroutines have completed\")\n}\n\nfunc main() {\n\tfmt.Println(\"Starting Distributed Node Manager\")\n\n\tmanager := NewNodeManager()\n\tmanager.Start()\n\n\tfmt.Println(\"Node Manager started, running for 10 seconds...\")\n\ttime.Sleep(10 * time.Second)\n\n\tfmt.Println(\"Initiating shutdown...\")\n\tmanager.Shutdown()\n\n\tfmt.Println(\"Shutdown complete\")\n}",
            "passed": true,
            "errors": []
        }
    ],
    "passed": true
}