{
    "task": "2f16895ee94848e2d8ad72bc01968b4c88d84cb8.txt",
    "provider": "anthropic",
    "model": "claude-haiku-4-5",
    "rounds": [
        {
            "code": "package main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype DeviceManager struct {\n\tmu               sync.RWMutex\n\tactiveDevices    map[string]bool\n\tdeletedDevices   map[string]bool\n\tdeletionCount    int\n\tcleanupCount     int\n}\n\nfunc NewDeviceManager() *DeviceManager {\n\treturn &DeviceManager{\n\t\tactiveDevices:  make(map[string]bool),\n\t\tdeletedDevices: make(map[string]bool),\n\t\tdeletionCount:  0,\n\t\tcleanupCount:   0,\n\t}\n}\n\nfunc (dm *DeviceManager) AddDevice(deviceID string) bool {\n\tdm.mu.Lock()\n\tdefer dm.mu.Unlock()\n\n\tif dm.activeDevices[deviceID] || dm.deletedDevices[deviceID] {\n\t\treturn false\n\t}\n\n\tdm.activeDevices[deviceID] = true\n\treturn true\n}\n\nfunc (dm *DeviceManager) MarkForDeletion(deviceID string) bool {\n\tdm.mu.Lock()\n\tdefer dm.mu.Unlock()\n\n\tif !dm.activeDevices[deviceID] {\n\t\treturn false\n\t}\n\n\tdelete(dm.activeDevices, deviceID)\n\tdm.deletedDevices[deviceID] = true\n\tdm.deletionCount++\n\treturn true\n}\n\nfunc (dm *DeviceManager) CleanupDeletedDevices() {\n\tdm.mu.Lock()\n\n\tif len(dm.deletedDevices) == 0 {\n\t\tdm.mu.Unlock()\n\t\treturn\n\t}\n\n\tdeletedCount := len(dm.deletedDevices)\n\tdm.deletedDevices = make(map[string]bool)\n\tdm.cleanupCount++\n\n\tdm.mu.Unlock()\n\n\tfmt.Printf(\"[Cleanup %d] Removed %d deleted devices\\n\", dm.GetCleanupCount(), deletedCount)\n}\n\nfunc (dm *DeviceManager) GetStatus() (activeCount, deletedCount, deletionCount, cleanupCount int) {\n\tdm.mu.RLock()\n\tdefer dm.mu.RUnlock()\n\n\treturn len(dm.activeDevices), len(dm.deletedDevices), dm.deletionCount, dm.cleanupCount\n}\n\nfunc (dm *DeviceManager) GetActiveCount() int {\n\tdm.mu.RLock()\n\tdefer dm.mu.RUnlock()\n\treturn len(dm.activeDevices)\n}\n\nfunc (dm *DeviceManager) GetDeletedCount() int {\n\tdm.mu.RLock()\n\tdefer dm.mu.RUnlock()\n\treturn len(dm.deletedDevices)\n}\n\nfunc (dm *DeviceManager) GetDeletionCount() int {\n\tdm.mu.RLock()\n\tdefer dm.mu.RUnlock()\n\treturn dm.deletionCount\n}\n\nfunc (dm *DeviceManager) GetCleanupCount() int {\n\tdm.mu.RLock()\n\tdefer dm.mu.RUnlock()\n\treturn dm.cleanupCount\n}\n\nfunc main() {\n\tdm := NewDeviceManager()\n\tctx := time.After(10 * time.Second)\n\tticker := time.NewTicker(500 * time.Millisecond)\n\tdefer ticker.Stop()\n\n\tvar wg sync.WaitGroup\n\n\tdeviceCounter := 0\n\tdeviceMutex := sync.Mutex{}\n\n\tgetNextDeviceID := func() string {\n\t\tdeviceMutex.Lock()\n\t\tdefer deviceMutex.Unlock()\n\t\tdeviceCounter++\n\t\treturn fmt.Sprintf(\"device_%d\", deviceCounter)\n\t}\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase <-ctx:\n\t\t\t\treturn\n\t\t\tcase <-ticker.C:\n\t\t\t\tfor i := 0; i < 3; i++ {\n\t\t\t\t\tdeviceID := getNextDeviceID()\n\t\t\t\t\tif dm.AddDevice(deviceID) {\n\t\t\t\t\t\tfmt.Printf(\"[Add] Added %s\\n\", deviceID)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}()\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\ttime.Sleep(100 * time.Millisecond)\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase <-ctx:\n\t\t\t\treturn\n\t\t\tcase <-ticker.C:\n\t\t\t\tactive := dm.GetActiveCount()\n\t\t\t\tif active > 0 {\n\t\t\t\t\tfor i := 0; i < 2 && i < active; i++ {\n\t\t\t\t\t\tdeviceID := fmt.Sprintf(\"device_%d\", (i + 1))\n\t\t\t\t\t\tif dm.MarkForDeletion(deviceID) {\n\t\t\t\t\t\t\tfmt.Printf(\"[Delete] Marked %s for deletion\\n\", deviceID)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}()\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tcleanupTicker := time.NewTicker(1 * time.Second)\n\t\tdefer cleanupTicker.Stop()\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase <-ctx:\n\t\t\t\treturn\n\t\t\tcase <-cleanupTicker.C:\n\t\t\t\tdm.CleanupDeletedDevices()\n\t\t\t}\n\t\t}\n\t}()\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tstatusTicker := time.NewTicker(2 * time.Second)\n\t\tdefer statusTicker.Stop()\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase <-ctx:\n\t\t\t\treturn\n\t\t\tcase <-statusTicker.C:\n\t\t\t\tactive, deleted, deletions, cleanups := dm.GetStatus()\n\t\t\t\tfmt.Printf(\"[Status] Active: %d, Deleted: %d, Total Deletions: %d, Cleanups: %d\\n\",\n\t\t\t\t\tactive, deleted, deletions, cleanups)\n\t\t\t}\n\t\t}\n\t}()\n\n\twg.Wait()\n\n\tactive, deleted, deletions, cleanups := dm.GetStatus()\n\tfmt.Printf(\"\\n=== Final Status ===\\n\")\n\tfmt.Printf(\"Active Devices: %d\\n\", active)\n\tfmt.Printf(\"Deleted Devices: %d\\n\", deleted)\n\tfmt.Printf(\"Total Devices Marked for Deletion: %d\\n\", deletions)\n\tfmt.Printf(\"Cleanup Operations Performed: %d\\n\", cleanups)\n\tfmt.Println(\"Device Manager test completed successfully!\")\n}",
            "passed": true,
            "errors": []
        }
    ],
    "passed": true
}