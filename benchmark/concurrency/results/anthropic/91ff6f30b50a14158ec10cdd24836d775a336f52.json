{
    "task": "91ff6f30b50a14158ec10cdd24836d775a336f52.txt",
    "provider": "anthropic",
    "model": "claude-haiku-4-5",
    "rounds": [
        {
            "code": "package main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype Event struct {\n\tID   int\n\tData string\n}\n\ntype Receiver struct {\n\tID       int\n\tEventCh  chan Event\n\tdone     chan struct{}\n\treceived int\n\tmu       sync.Mutex\n}\n\nfunc NewReceiver(id int) *Receiver {\n\treturn &Receiver{\n\t\tID:      id,\n\t\tEventCh: make(chan Event, 10),\n\t\tdone:    make(chan struct{}),\n\t}\n}\n\nfunc (r *Receiver) Start() {\n\tfor {\n\t\tselect {\n\t\tcase event := <-r.EventCh:\n\t\t\tr.mu.Lock()\n\t\t\tr.received++\n\t\t\tr.mu.Unlock()\n\t\t\tfmt.Printf(\"Receiver %d received event %d: %s\\n\", r.ID, event.ID, event.Data)\n\t\tcase <-r.done:\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc (r *Receiver) Stop() {\n\tclose(r.done)\n}\n\nfunc (r *Receiver) ReceivedCount() int {\n\tr.mu.Lock()\n\tdefer r.mu.Unlock()\n\treturn r.received\n}\n\ntype Metrics struct {\n\tEventsDistributed int\n\tActiveReceivers   int\n}\n\ntype Broadcaster struct {\n\treceivers map[*Receiver]bool\n\tmu        sync.RWMutex\n\tmetrics   Metrics\n\tmetricsMu sync.RWMutex\n}\n\nfunc NewBroadcaster() *Broadcaster {\n\treturn &Broadcaster{\n\t\treceivers: make(map[*Receiver]bool),\n\t\tmetrics: Metrics{\n\t\t\tEventsDistributed: 0,\n\t\t\tActiveReceivers:   0,\n\t\t},\n\t}\n}\n\nfunc (b *Broadcaster) Register(receiver *Receiver) {\n\tb.mu.Lock()\n\tdefer b.mu.Unlock()\n\tif !b.receivers[receiver] {\n\t\tb.receivers[receiver] = true\n\t\tb.metricsMu.Lock()\n\t\tb.metrics.ActiveReceivers++\n\t\tb.metricsMu.Unlock()\n\t\tfmt.Printf(\"Registered receiver %d (total active: %d)\\n\", receiver.ID, b.metrics.ActiveReceivers)\n\t}\n}\n\nfunc (b *Broadcaster) Unregister(receiver *Receiver) {\n\tb.mu.Lock()\n\tdefer b.mu.Unlock()\n\tif b.receivers[receiver] {\n\t\tdelete(b.receivers, receiver)\n\t\treceiver.Stop()\n\t\tb.metricsMu.Lock()\n\t\tb.metrics.ActiveReceivers--\n\t\tb.metricsMu.Unlock()\n\t\tfmt.Printf(\"Unregistered receiver %d (total active: %d)\\n\", receiver.ID, b.metrics.ActiveReceivers)\n\t}\n}\n\nfunc (b *Broadcaster) Broadcast(event Event) {\n\tb.mu.RLock()\n\treceivers := make([]*Receiver, 0, len(b.receivers))\n\tfor receiver := range b.receivers {\n\t\treceivers = append(receivers, receiver)\n\t}\n\tb.mu.RUnlock()\n\n\tvar wg sync.WaitGroup\n\tfor _, receiver := range receivers {\n\t\twg.Add(1)\n\t\tgo func(r *Receiver) {\n\t\t\tdefer wg.Done()\n\t\t\tselect {\n\t\t\tcase r.EventCh <- event:\n\t\t\t\tb.metricsMu.Lock()\n\t\t\t\tb.metrics.EventsDistributed++\n\t\t\t\tb.metricsMu.Unlock()\n\t\t\tcase <-time.After(100 * time.Millisecond):\n\t\t\t\tfmt.Printf(\"Timeout sending event %d to receiver %d\\n\", event.ID, r.ID)\n\t\t\t}\n\t\t}(receiver)\n\t}\n\twg.Wait()\n\tfmt.Printf(\"Broadcasted event %d to %d receivers\\n\", event.ID, len(receivers))\n}\n\nfunc (b *Broadcaster) ReceiverCount() int {\n\tb.mu.RLock()\n\tdefer b.mu.RUnlock()\n\treturn len(b.receivers)\n}\n\nfunc (b *Broadcaster) GetMetrics() Metrics {\n\tb.metricsMu.RLock()\n\tdefer b.metricsMu.RUnlock()\n\treturn b.metrics\n}\n\nfunc (b *Broadcaster) Close() {\n\tb.mu.Lock()\n\tdefer b.mu.Unlock()\n\tfor receiver := range b.receivers {\n\t\treceiver.Stop()\n\t}\n\tb.receivers = make(map[*Receiver]bool)\n\tb.metricsMu.Lock()\n\tb.metrics.ActiveReceivers = 0\n\tb.metricsMu.Unlock()\n}\n\nfunc main() {\n\tfmt.Println(\"=== Event Broadcaster System ===\\n\")\n\n\tbroadcaster := NewBroadcaster()\n\treceivers := make([]*Receiver, 5)\n\n\tfor i := 0; i < 5; i++ {\n\t\treceivers[i] = NewReceiver(i)\n\t\tbroadcaster.Register(receivers[i])\n\t\tgo receivers[i].Start()\n\t}\n\n\tfmt.Printf(\"\\nStarting with %d receivers\\n\\n\", broadcaster.ReceiverCount())\n\n\tvar wg sync.WaitGroup\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor i := 0; i < 10; i++ {\n\t\t\tevent := Event{ID: i, Data: fmt.Sprintf(\"event_%d\", i)}\n\t\t\tbroadcaster.Broadcast(event)\n\t\t\ttime.Sleep(200 * time.Millisecond)\n\n\t\t\tif i == 3 {\n\t\t\t\tfmt.Println(\"\\n--- Removing receiver 1 ---\")\n\t\t\t\tbroadcaster.Unregister(receivers[1])\n\t\t\t}\n\t\t\tif i == 6 {\n\t\t\t\tfmt.Println(\"\\n--- Adding new receiver 5 ---\")\n\t\t\t\tnewReceiver := NewReceiver(5)\n\t\t\t\treceivers = append(receivers, newReceiver)\n\t\t\t\tbroadcaster.Register(newReceiver)\n\t\t\t\tgo newReceiver.Start()\n\t\t\t}\n\t\t}\n\t}()\n\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor i := 0; i < 4; i++ {\n\t\t\ttime.Sleep(600 * time.Millisecond)\n\t\t\tfmt.Printf(\"\\n[Status Check] Active receivers: %d, Events distributed: %d\\n\", broadcaster.ReceiverCount(), broadcaster.GetMetrics().EventsDistributed)\n\t\t}\n\t}()\n\n\twg.Wait()\n\n\ttime.Sleep(500 * time.Millisecond)\n\n\tfmt.Println(\"\\n=== Final Report ===\")\n\tfmt.Printf(\"Total active receivers: %d\\n\", broadcaster.ReceiverCount())\n\tmetrics := broadcaster.GetMetrics()\n\tfmt.Printf(\"Total events distributed: %d\\n\", metrics.EventsDistributed)\n\n\tfor i, receiver := range receivers {\n\t\tif broadcaster.ReceiverCount() > 0 || receiver.ReceivedCount() > 0 {\n\t\t\tfmt.Printf(\"Receiver %d received: %d events\\n\", i, receiver.ReceivedCount())\n\t\t}\n\t}\n\n\tbroadcaster.Close()\n\tfmt.Println(\"\\nBroadcaster closed\")\n}",
            "passed": true,
            "errors": []
        }
    ],
    "passed": true
}