{
    "task": "010a127314a935d8d038f8dd4559fc5b249813e4.txt",
    "provider": "anthropic",
    "model": "claude-haiku-4-5",
    "rounds": [
        {
            "code": "package main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype ResourceUpdate struct {\n\tResourceType string\n\tIdentifier   string\n\tUsageValue   float64\n}\n\ntype ResourceMonitor struct {\n\thighPriorityQueue chan ResourceUpdate\n\tlowPriorityQueue  chan ResourceUpdate\n\tworkers           int\n\tconfiguredTypes   map[string]bool\n\tconfigMutex       sync.RWMutex\n\tresourceData      map[string]map[string]float64\n\tdataMutex         sync.RWMutex\n\tworkerWg          sync.WaitGroup\n\tshutdownCh        chan struct{}\n\tpauseCh           chan struct{}\n\tresumeCh          chan struct{}\n\treconfigMutex     sync.Mutex\n}\n\nfunc NewResourceMonitor(workers int, initialTypes []string) *ResourceMonitor {\n\trm := &ResourceMonitor{\n\t\thighPriorityQueue: make(chan ResourceUpdate, 100),\n\t\tlowPriorityQueue:  make(chan ResourceUpdate, 100),\n\t\tworkers:           workers,\n\t\tconfiguredTypes:   make(map[string]bool),\n\t\tresourceData:      make(map[string]map[string]float64),\n\t\tshutdownCh:        make(chan struct{}),\n\t\tpauseCh:           make(chan struct{}),\n\t\tresumeCh:          make(chan struct{}),\n\t}\n\n\tfor _, t := range initialTypes {\n\t\trm.configuredTypes[t] = true\n\t\trm.resourceData[t] = make(map[string]float64)\n\t}\n\n\treturn rm\n}\n\nfunc (rm *ResourceMonitor) Start() {\n\tfor i := 0; i < rm.workers/2; i++ {\n\t\trm.workerWg.Add(1)\n\t\tgo rm.worker(rm.highPriorityQueue, fmt.Sprintf(\"high-%d\", i))\n\t}\n\n\tfor i := 0; i < rm.workers/2; i++ {\n\t\trm.workerWg.Add(1)\n\t\tgo rm.worker(rm.lowPriorityQueue, fmt.Sprintf(\"low-%d\", i))\n\t}\n\n\tfmt.Printf(\"[MONITOR] Started %d workers\\n\", rm.workers)\n}\n\nfunc (rm *ResourceMonitor) worker(queue chan ResourceUpdate, workerID string) {\n\tdefer rm.workerWg.Done()\n\n\tfor {\n\t\tselect {\n\t\tcase <-rm.shutdownCh:\n\t\t\tfmt.Printf(\"[%s] Worker shutting down\\n\", workerID)\n\t\t\treturn\n\t\tcase update := <-queue:\n\t\t\trm.pauseCh <- struct{}{}\n\t\t\t<-rm.resumeCh\n\n\t\t\trm.configMutex.RLock()\n\t\t\tisConfigured := rm.configuredTypes[update.ResourceType]\n\t\t\trm.configMutex.RUnlock()\n\n\t\t\tif isConfigured {\n\t\t\t\trm.recordUpdate(update)\n\t\t\t\tfmt.Printf(\"[%s] Processed: %s/%s = %.2f\\n\", workerID, update.ResourceType, update.Identifier, update.UsageValue)\n\t\t\t} else {\n\t\t\t\tfmt.Printf(\"[%s] Skipped unconfigured type: %s\\n\", workerID, update.ResourceType)\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (rm *ResourceMonitor) recordUpdate(update ResourceUpdate) {\n\trm.dataMutex.Lock()\n\tdefer rm.dataMutex.Unlock()\n\n\tif _, exists := rm.resourceData[update.ResourceType]; !exists {\n\t\trm.resourceData[update.ResourceType] = make(map[string]float64)\n\t}\n\trm.resourceData[update.ResourceType][update.Identifier] = update.UsageValue\n}\n\nfunc (rm *ResourceMonitor) SubmitHighPriority(update ResourceUpdate) {\n\tselect {\n\tcase rm.highPriorityQueue <- update:\n\tcase <-rm.shutdownCh:\n\t\tfmt.Println(\"[SUBMIT] System shutting down, rejecting update\")\n\t}\n}\n\nfunc (rm *ResourceMonitor) SubmitLowPriority(update ResourceUpdate) {\n\tselect {\n\tcase rm.lowPriorityQueue <- update:\n\tcase <-rm.shutdownCh:\n\t\tfmt.Println(\"[SUBMIT] System shutting down, rejecting update\")\n\t}\n}\n\nfunc (rm *ResourceMonitor) Reconfigure(newTypes []string) {\n\trm.reconfigMutex.Lock()\n\tdefer rm.reconfigMutex.Unlock()\n\n\tfmt.Println(\"[RECONFIG] Pausing workers for reconfiguration...\")\n\n\tpendingAcks := 2 * rm.workers\n\tfor i := 0; i < pendingAcks; i++ {\n\t\tselect {\n\t\tcase <-rm.pauseCh:\n\t\tcase <-time.After(100 * time.Millisecond):\n\t\t}\n\t}\n\n\ttime.Sleep(100 * time.Millisecond)\n\n\trm.configMutex.Lock()\n\trm.configuredTypes = make(map[string]bool)\n\tnewResourceData := make(map[string]map[string]float64)\n\n\tfor _, t := range newTypes {\n\t\trm.configuredTypes[t] = true\n\t\tif existing, ok := rm.resourceData[t]; ok {\n\t\t\tnewResourceData[t] = existing\n\t\t} else {\n\t\t\tnewResourceData[t] = make(map[string]float64)\n\t\t}\n\t}\n\n\trm.dataMutex.Lock()\n\trm.resourceData = newResourceData\n\trm.dataMutex.Unlock()\n\n\trm.configMutex.Unlock()\n\n\tfmt.Printf(\"[RECONFIG] Updated configuration to: %v\\n\", newTypes)\n\n\tfor i := 0; i < pendingAcks; i++ {\n\t\trm.resumeCh <- struct{}{}\n\t}\n\n\tfmt.Println(\"[RECONFIG] Workers resumed\")\n}\n\nfunc (rm *ResourceMonitor) GetResourceData() map[string]map[string]float64 {\n\trm.dataMutex.RLock()\n\tdefer rm.dataMutex.RUnlock()\n\n\tresult := make(map[string]map[string]float64)\n\tfor resType, data := range rm.resourceData {\n\t\tresult[resType] = make(map[string]float64)\n\t\tfor id, val := range data {\n\t\t\tresult[resType][id] = val\n\t\t}\n\t}\n\treturn result\n}\n\nfunc (rm *ResourceMonitor) Shutdown() {\n\tfmt.Println(\"[MONITOR] Initiating graceful shutdown...\")\n\tclose(rm.shutdownCh)\n\trm.workerWg.Wait()\n\tclose(rm.highPriorityQueue)\n\tclose(rm.lowPriorityQueue)\n\tfmt.Println(\"[MONITOR] Shutdown complete\")\n}\n\nfunc main() {\n\tfmt.Println(\"=== Resource Monitor with Dynamic Configuration ===\\n\")\n\n\tinitialTypes := []string{\"CPU\", \"Memory\", \"Disk\"}\n\tmonitor := NewResourceMonitor(10, initialTypes)\n\tmonitor.Start()\n\n\ttime.Sleep(500 * time.Millisecond)\n\n\tfmt.Println(\"\\n--- Submitting initial updates ---\")\n\tfor i := 0; i < 5; i++ {\n\t\tmonitor.SubmitHighPriority(ResourceUpdate{\n\t\t\tResourceType: \"CPU\",\n\t\t\tIdentifier:   fmt.Sprintf(\"core-%d\", i),\n\t\t\tUsageValue:   float64(20 + i*5),\n\t\t})\n\t\tmonitor.SubmitLowPriority(ResourceUpdate{\n\t\t\tResourceType: \"Memory\",\n\t\t\tIdentifier:   fmt.Sprintf(\"slot-%d\", i),\n\t\t\tUsageValue:   float64(30 + i*10),\n\t\t})\n\t}\n\n\ttime.Sleep(1 * time.Second)\n\n\tfmt.Println(\"\\n--- Reconfiguring system ---\")\n\tmonitor.Reconfigure([]string{\"CPU\", \"Network\", \"Disk\"})\n\n\ttime.Sleep(500 * time.Millisecond)\n\n\tfmt.Println(\"\\n--- Submitting updates after reconfiguration ---\")\n\tfor i := 0; i < 3; i++ {\n\t\tmonitor.SubmitHighPriority(ResourceUpdate{\n\t\t\tResourceType: \"Network\",\n\t\t\tIdentifier:   fmt.Sprintf(\"eth-%d\", i),\n\t\t\tUsageValue:   float64(50 + i*15),\n\t\t})\n\t\tmonitor.SubmitLowPriority(ResourceUpdate{\n\t\t\tResourceType: \"Memory\",\n\t\t\tIdentifier:   fmt.Sprintf(\"mem-%d\", i),\n\t\t\tUsageValue:   float64(60 + i*5),\n\t\t})\n\t\tmonitor.SubmitLowPriority(ResourceUpdate{\n\t\t\tResourceType: \"Disk\",\n\t\t\tIdentifier:   fmt.Sprintf(\"sda-%d\", i),\n\t\t\tUsageValue:   float64(75 + i*2),\n\t\t})\n\t}\n\n\ttime.Sleep(1 * time.Second)\n\n\tfmt.Println(\"\\n--- Resource Data ---\")\n\tdata := monitor.GetResourceData()\n\tfor resType, resources := range data {\n\t\tfmt.Printf(\"\\n%s:\\n\", resType)\n\t\tfor id, usage := range resources {\n\t\t\tfmt.Printf(\"  %s: %.2f\\n\", id, usage)\n\t\t}\n\t}\n\n\tfmt.Println(\"\\n--- Shutting down ---\")\n\tmonitor.Shutdown()\n\n\tfmt.Println(\"\\n=== Test Complete ===\")\n}",
            "passed": true,
            "errors": []
        }
    ],
    "passed": true
}